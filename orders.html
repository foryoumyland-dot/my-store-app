<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<base href="/my-store-app/">
<title>Ø·Ù„Ø¨Ø§ØªÙŠ | Ø±ÙŠÙ€Ù€Ù€ÙÙ€Ù€Ù€REVANAÙ€Ù€Ù€Ù€Ø§Ù†Ù€Ù€Ù€Ù€Ù€Ø§</title> <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
  /* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø§Ù„Ø«Ø§Ø¨Øª ÙˆØ§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ ===== */
  .top-navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: linear-gradient(135deg, #ff69b4, #ff1493);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(255, 105, 180, 0.4);
      border-bottom: 2px solid #ffb6c1;
  }

  /* Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† - Ù†Øµ Ø¹Ø§Ø¯ÙŠ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù†Ù‚Ø± */
  .store-name {
      color: white;
      font-weight: bold;
      font-size: 1.3rem;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      padding: 8px 20px;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      cursor: default;
      user-select: none;
      position: relative;
      overflow: hidden;
  }

  /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù„Ù…Ø¹Ø© Ù„Ù„Ø§Ø³Ù… */
  .store-name::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
  }

  .store-name:hover::before {
      left: 100%;
  }

  /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
  .menu-icon {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 1.4rem;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
  }

  .menu-icon:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.5);
  }

  /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
  .dropdown-menu {
      position: absolute;
      top: 65px;
      right: 20px;
      background: linear-gradient(135deg, #ffffff, #fff5f7);
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(255, 105, 180, 0.3);
      padding: 0;
      min-width: 200px;
      display: none;
      z-index: 1001;
      border: 2px solid #ffe4ec;
      backdrop-filter: blur(10px);
      text-align: center;
  }

  .dropdown-menu.show {
      display: block;
      animation: slideDown 0.3s ease;
  }

  @keyframes slideDown {
      from {
          opacity: 0;
          transform: translateY(-10px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  .dropdown-item {
      display: block;
      padding: 15px 20px;
      text-decoration: none;
      color: #d63384;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      border: none;
      background: none;
      width: 100%;
      text-align: center;
  }

  .dropdown-item:hover {
      background: linear-gradient(45deg, #fff0f6, #ffe4ec);
      color: #ff1493;
  }

  /* Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  .menu-divider {
      width: 80%;
      height: 1px;
      background: linear-gradient(90deg, transparent, #ffb6c1, transparent);
      margin: 0 auto;
  }

  /* Ø­Ø¬Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§ */
  .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: 999;
      display: none;
  }

  /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª */
  @media (max-width: 768px) {
      .top-navbar {
          height: 55px;
          padding: 0 15px;
      }
      
      .store-name {
          font-size: 1.1rem;
          padding: 6px 15px;
      }
      
      .menu-icon {
          font-size: 1.2rem;
          padding: 6px 10px;
      }
      
      .dropdown-menu {
          min-width: 180px;
          top: 60px;
          right: 15px;
      }
      
      .dropdown-item {
          padding: 12px 16px;
          font-size: 0.9rem;
      }
  }

  @media (max-width: 480px) {
      .top-navbar {
          height: 50px;
          padding: 0 10px;
      }
      
      .store-name {
          font-size: 1rem;
          padding: 5px 12px;
      }
      
      .menu-icon {
          font-size: 1.1rem;
          padding: 5px 8px;
      }
      
      .dropdown-menu {
          min-width: 160px;
          top: 55px;
          right: 10px;
      }
      
      .dropdown-item {
          padding: 10px 14px;
          font-size: 0.85rem;
      }
  }

  @media (min-width: 1200px) {
      .top-navbar {
          height: 65px;
          padding: 0 25px;
      }
      
      .store-name {
          font-size: 1.5rem;
          padding: 10px 25px;
      }
      
      .menu-icon {
          font-size: 1.6rem;
          padding: 10px 15px;
      }
      
      .dropdown-menu {
          min-width: 220px;
          top: 70px;
          right: 25px;
      }
      
      .dropdown-item {
          padding: 16px 22px;
          font-size: 1.1rem;
      }
  }

  /* ===== ØªÙ†Ø³ÙŠÙ‚Ø§Øª ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ===== */
  body { 
    font-family: Tahoma; 
    background:#f9f9f9; 
    margin: 0;
    padding-top: 70px;
    padding-bottom: 80px;
    direction: rtl; 
  }
  h2 { 
    color:#d63384; 
    text-align:center; 
    margin-top: 20px;
  }
  .order { 
    background:#fff; 
    padding:15px; 
    margin:10px 15px; 
    border-radius:8px; 
    box-shadow:0 2px 6px rgba(0,0,0,0.1); 
    border-right: 4px solid #d63384;
  }
  .order h3 { 
    margin:0 0 8px; 
    color:#333; 
  }
  .status { 
    font-weight:bold; 
    padding: 4px 8px;
    border-radius: 4px;
    display: inline-block;
  }
  .status-pending { background: #fff3cd; color: #856404; }
  .status-confirmed { background: #d1ecf1; color: #0c5460; }
  .status-shipping { background: #d1e7ff; color: #004085; }
  .status-delivered { background: #d4edda; color: #155724; }
  .status-cancelled { background: #f8d7da; color: #721c24; }
  .status-cancelled-by-customer { background: #f8d7da; color: #721c24; }
  
  .btn-action { 
    color: white; 
    border: none; 
    padding: 10px 16px; 
    border-radius: 8px; 
    cursor: pointer; 
    margin-top: 10px;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.3s ease;
  }
  
  .btn-cancel {
    background: linear-gradient(45deg, #dc3545, #c82333);
  }
  
  .btn-restore {
    background: linear-gradient(45deg, #28a745, #20c997);
  }
  
  .user-info {
    background: #e9f7ef;
    padding: 15px;
    margin: 15px;
    border-radius: 8px;
    text-align: center;
    border-right: 4px solid #28a745;
  }
  
  .no-orders {
    text-align: center;
    color: #666;
    padding: 40px 20px;
    font-size: 18px;
  }
  
  .loading {
    text-align: center;
    color: #d63384;
    padding: 20px;
    font-size: 16px;
  }
  
  /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ */
  .confirm-modal { 
    display: none; 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    background: rgba(0,0,0,0.5); 
    z-index: 5000; 
    justify-content: center; 
    align-items: center; 
  }
  .confirm-content { 
    background: white; 
    padding: 25px; 
    border-radius: 15px; 
    text-align: center; 
    box-shadow: 0 5px 25px rgba(0,0,0,0.3);
    max-width: 400px;
    width: 90%;
    margin: 20px;
  }
  .confirm-buttons { 
    margin-top: 20px; 
    display: flex; 
    gap: 10px; 
    justify-content: center;
  }
  
  /* ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„Ù…ØªØ¬Ø± */
  .alert-custom { 
    position: fixed; 
    top: 80px; 
    left: 50%; 
    transform: translateX(-50%); 
    background: linear-gradient(45deg, #ff416c, #ff4b2b); 
    color: white; 
    padding: 12px 20px; 
    border-radius: 8px; 
    font-size: 16px; 
    font-weight: bold; 
    z-index: 3000; 
    display: none; 
  }
</style>
</head>
<body>

<nav class="top-navbar">
    <button class="menu-icon" onclick="toggleMenu()">â˜°</button>
    
    <div class="store-name">ğŸŒ¸ Ø±ÙŠÙ€Ù€Ù€ÙÙ€Ù€Ù€<span dir="ltr">REVANA</span>Ù€Ù€Ù€Ù€Ø§Ù†Ù€Ù€Ù€Ù€Ù€Ø§</div>
    
    <div class="dropdown-menu" id="dropdownMenu">
        <a href="profile.html" class="dropdown-item" onclick="closeMenu()">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</a>
        <div class="menu-divider"></div>
        <a href="orders.html" class="dropdown-item" onclick="closeMenu()">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</a>
    </div>
</nav>

<div class="overlay" id="overlay" onclick="closeMenu()"></div>

<div id="confirmModal" class="confirm-modal">
  <div class="confirm-content">
    <div id="confirmIcon" style="font-size: 3rem; margin-bottom: 15px;">âš ï¸</div>
    <h5 id="confirmTitle" style="color: #d63384;"></h5>
    <p id="confirmMessage"></p>
    <div class="confirm-buttons">
      <button id="confirmAction" class="btn-action" style="min-width: 100px;"></button>
      <button id="confirmCancel" class="btn-action" style="background: #6c757d; min-width: 100px;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<div id="alertBox" class="alert-custom"></div>

<iframe src="bottom-nav.html" style="width:100%; height:80px; border:none; position: fixed; bottom: 0; left: 0; z-index: 1000;"></iframe>

<h2>ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</h2>

<div id="userInfo" class="user-info" style="display:none;">
    <strong>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: </strong><span id="customerName"></span> - 
    <strong>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: </strong><span id="customerPhone"></span>
</div>

<div id="orders" class="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>

<script>
// âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
const firebaseConfig = {
    apiKey: "AIzaSyA-LdNQbQneJyxJQ8iMUUd5gsJypTFi6sg",
    authDomain: "mystore-orders-a74f8.firebaseapp.com",
    databaseURL: "https://mystore-orders-a74f8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "mystore-orders-a74f8",
    storageBucket: "mystore-orders-a74f8.appspot.com",
    messagingSenderId: "431733924264",
    appId: "1:431733924264:web:986b8dc983ef8c0097bd9d"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† localStorage
let userProfile = JSON.parse(localStorage.getItem('userProfile'));

let currentOrderId = null;

// ğŸ†• Ø¯Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø¶Ø§ÙØ© Ù„Ø¶Ù…Ø§Ù† Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚)
function cleanPhoneNumber(phone) {
    if (!phone) return "";
    // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ§Ù„Ø´Ø±Ø·Ø§Øª ÙˆØ£Ù‚ÙˆØ§Ø³ Ø§Ù„ØªØ¬Ù…ÙŠØ¹
    return phone.toString().replace(/[\s\-\(\)\.]/g, '').trim(); 
}

// ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
function toggleMenu() {
    const menu = document.getElementById('dropdownMenu');
    const overlay = document.getElementById('overlay');
    
    if (menu.classList.contains('show')) {
        closeMenu();
    } else {
        menu.classList.add('show');
        overlay.style.display = 'block';
    }
}

function closeMenu() {
    const menu = document.getElementById('dropdownMenu');
    const overlay = document.getElementById('overlay');
    
    menu.classList.remove('show');
    overlay.style.display = 'none';
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener('click', function(event) {
    const menu = document.getElementById('dropdownMenu');
    const icon = document.querySelector('.menu-icon');
    
    if (!menu.contains(event.target) && !icon.contains(event.target)) {
        closeMenu();
    }
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø·
document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function() {
        closeMenu();
    });
});

// âœ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
function showAlert(msg, type = 'success'){
  let box = document.getElementById("alertBox");
  box.innerHTML = msg;
  
  if (type === 'success') {
    box.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
  } else if (type === 'error') {
    box.style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
  } else {
    box.style.background = 'linear-gradient(45deg, #ff416c, #ff4b2b)';
  }
  
  box.style.display = "block";
  setTimeout(()=> box.style.display="none", 3000);
}

// âœ… Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
function showConfirm(title, message, actionText, actionCallback) {
    document.getElementById('confirmTitle').textContent = title;
    document.getElementById('confirmMessage').textContent = message;
    document.getElementById('confirmAction').textContent = actionText;
    
    if (actionText.includes('Ø¥Ù„ØºØ§Ø¡')) {
        document.getElementById('confirmAction').className = 'btn-action btn-cancel';
        document.getElementById('confirmIcon').textContent = 'âš ï¸';
    } else {
        document.getElementById('confirmAction').className = 'btn-action btn-restore';
        document.getElementById('confirmIcon').textContent = 'ğŸ”„';
    }
    
    document.getElementById('confirmAction').onclick = actionCallback;
    document.getElementById('confirmModal').style.display = 'flex';
}

function closeConfirm() {
    document.getElementById('confirmModal').style.display = 'none';
    currentOrderId = null;
}

// âœ… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø¸ÙŠÙØ©)
window.onload = function() {
    if (userProfile && userProfile.name && userProfile.phone) {
        // ğŸ†• ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
        const cleanedPhone = cleanPhoneNumber(userProfile.phone);

        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('customerName').textContent = userProfile.name;
        document.getElementById('customerPhone').textContent = cleanedPhone;
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù†Ø¸ÙŠÙ
        loadUserOrders(cleanedPhone);
    } else {
        // Ø¥Ø°Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('orders').innerHTML = `
            <div class="no-orders">
                <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“</div>
                <h3 style="color: #d63384;">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                <p>ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                <button onclick="goToProfile()" class="btn-action btn-restore" style="margin-top: 15px;">
                    ğŸ‘¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>
        `;
    }
};

// âœ… ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø¸ÙŠÙØ© ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©)
function loadUserOrders(cleanedUserPhone) { // Ø§Ø³ØªÙ‚Ø¨Ù„Ù†Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù†Ø¸ÙŠÙ Ù‡Ù†Ø§
    db.ref("orders").on("value", function(snapshot) {
        let data = snapshot.val();
        let container = document.getElementById("orders");
        
        if (!data) {
            container.innerHTML = '<div class="no-orders">ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
            return;
        }

        let userOrders = [];
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        Object.entries(data).forEach(([orderId, order]) => {
            
            // ğŸ†• ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
            const orderCustomerPhone = order.customer && order.customer.phone ? cleanPhoneNumber(order.customer.phone) : null;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ù…Ø·Ø§Ø¨Ù‚ (Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¢Ù† ØªØªÙ… Ø¨ÙŠÙ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù†Ø¸ÙŠÙØ©)
            if (orderCustomerPhone === cleanedUserPhone) {
                userOrders.push({
                    id: orderId,
                    ...order
                });
            }
        });

        if (userOrders.length === 0) {
            container.innerHTML = `
                <div class="no-orders">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ“­</div>
                    <h3 style="color: #d63384;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h3>
                    <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>
                    <button onclick="goToStore()" class="btn-action btn-restore" style="margin-top: 15px;">
                        ğŸ›ï¸ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†
                    </button>
                </div>
            `;
            return;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
        container.innerHTML = '';
        userOrders.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        userOrders.forEach(order => {
            let itemsHtml = "<ul style='padding-right: 15px; margin: 10px 0;'>";
            
            if (order.items && Array.isArray(order.items)) {
                order.items.forEach(item => {
                    itemsHtml += `
                        <li style="margin-bottom: 8px; padding: 5px 0; border-bottom: 1px dashed #eee;">
                            <strong>${item.name}</strong>
                            ${item.size ? ` - Ù…Ù‚Ø§Ø³: ${item.size}` : ''}
                            ${item.color ? ` - Ù„ÙˆÙ†: ${item.color}` : ''}
                            ${item.type ? ` - Ù†ÙˆØ¹: ${item.type}` : ''}
                            <br>
                            <small>Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty || 1} Ã— Ø§Ù„Ø³Ø¹Ø±: ${item.price || 0} Ø¯.Ù„</small>
                            <br>
                            <strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${(item.price || 0) * (item.qty || 1)} Ø¯.Ù„</strong>
                        </li>
                    `;
                });
            } else {
                itemsHtml += "<li>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</li>";
            }
            itemsHtml += "</ul>";

            let statusClass = getStatusClass(order.status || "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±");
            let statusText = getStatusText(order.status || "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±");
            
            let actionBtn = "";
            
            // 1. Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (ÙŠØ¸Ù‡Ø± Ø¥Ø°Ø§ Ø£Ù„ØºÙŠ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†)
            if (order.status === "ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†") {
                actionBtn = `<button class="btn-action btn-restore" onclick="restoreOrder('${order.id}')">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>`;
            } 
            
            // 2. Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±")
            else if (order.status === "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±") {
                actionBtn = `<button class="btn-action btn-cancel" onclick="cancelOrder('${order.id}')">ğŸ—‘ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>`;
            }

            let orderDiv = document.createElement("div");
            orderDiv.className = "order";
            orderDiv.innerHTML = `
                <h3>ğŸ›ï¸ Ø·Ù„Ø¨ÙŠØ© #${order.id.substring(0, 8)}</h3>
                <div style="margin: 10px 0;">
                    ${itemsHtml}
                </div>
                <p><strong>ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${order.total || 0} Ø¯.Ù„</strong></p>
                <p>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${order.customer?.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}, ${order.customer?.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${order.timestamp ? new Date(order.timestamp).toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p>ğŸ“Œ Ø§Ù„Ø­Ø§Ù„Ø©: <span class="status ${statusClass}">${statusText}</span></p>
                <div style="margin-top: 15px;">
                    ${actionBtn}
                </div>
            `;
            container.appendChild(orderDiv);
        });
    }, function(error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        document.getElementById('orders').innerHTML = `
            <div class="no-orders">
                <div style="font-size: 3rem; margin-bottom: 15px;">âŒ</div>
                <h3 style="color: #d63384;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</h3>
                <p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.</p>
                <button onclick="location.reload()" class="btn-action" style="background:#6c757d; margin-top:15px;">
                    ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                </button>
            </div>
        `;
    });
}

// âœ… Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ø§Ù„Ø©
function getStatusText(status) {
    const statusMap = {
        'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±': 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
        'ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯': 'âœ… ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯', 
        'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„': 'ğŸšš Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„',
        'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…': 'ğŸ‰ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…',
        'Ù…Ù„ØºÙ‰': 'âŒ Ù…Ù„ØºÙ‰ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
        'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†': 'ğŸ—‘ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†'
    };
    return statusMap[status] || status;
}

function getStatusClass(status) {
    const classMap = {
        'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±': 'status-pending',
        'ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯': 'status-confirmed',
        'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„': 'status-shipping', 
        'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…': 'status-delivered',
        'Ù…Ù„ØºÙ‰': 'status-cancelled',
        'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†': 'status-cancelled-by-customer'
    };
    return classMap[status] || 'status-pending';
}

// âœ… Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
function cancelOrder(orderId) {
    currentOrderId = orderId;
    showConfirm(
        'âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨',
        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¥Ø°Ø§ Ø±ØºØ¨Øª.',
        'ğŸ—‘ Ù†Ø¹Ù…ØŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨',
        function() {
            db.ref("orders/" + orderId).update({ status: "ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù…Ù† Ø§Ù„Ø²Ø¨ÙˆÙ†" })
            .then(() => {
                showAlert('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeConfirm();
            })
            .catch(error => {
                showAlert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'error');
                closeConfirm();
            });
        }
    );
}

function restoreOrder(orderId) {
    currentOrderId = orderId;
    showConfirm(
        'ğŸ”„ ØªØ£ÙƒÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
        'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
        'ğŸ”„ Ù†Ø¹Ù…ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„',
        function() {
            db.ref("orders/" + orderId).update({ status: "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±" })
            .then(() => {
                showAlert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeConfirm();
            })
            .catch(error => {
                showAlert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'error');
                closeConfirm();
            });
        }
    );
}

// âœ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
document.getElementById('confirmCancel').onclick = closeConfirm;

// âœ… Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„
function goToProfile() {
    window.location.href = 'profile.html';
}

function goToStore() {
    window.location.href = 'index.html';
}
</script>

</body>
</html>
